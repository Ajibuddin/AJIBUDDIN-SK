<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>সহজ সূরা - বাংলা উচ্চারণ ও অর্থ</title>
    <style>
        :root {
            --primary: #2c786c;
            --secondary: #004445;
            --light: #f8f1f1;
            --dark: #021c1e;
            --accent: #ff7e33;
            --border-dark: #021c1e;
            --border-light: #dddddd;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: var(--dark);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .dark-mode {
            background-color: var(--dark);
            color: var(--light);
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            text-align: center;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--accent);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        
        .search-bar {
            width: 100%;
            padding: 0.8rem 1rem;
            margin: 1rem 0;
            border: 3px solid var(--border-dark);
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
            background-color: white;
            color: var(--dark);
        }

        .dark-mode .search-bar {
            border-color: var(--border-light);
            background-color: #032b2d;
            color: var(--light);
        }

        /* 2x2 Grid for Feature Buttons */
        .feature-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .feature-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .feature-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        
        .surah-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .surah-card {
            background: white; border-radius: 10px; overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: transform 0.3s ease;
        }
        
        .dark-mode .surah-card { background: #032b2d; }
        .surah-card:hover { transform: translateY(-5px); }
        
        .surah-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white;
            padding: 1rem; display: flex; justify-content: space-between; align-items: center;
        }
        
        .surah-content { padding: 1.5rem; }
        .arabic-preview {
            font-size: 1.2rem; text-align: right; line-height: 2rem;
            font-family: 'Traditional Arabic', 'Amiri', serif; margin-bottom: 1rem; direction: rtl;
        }
        .details-btn {
             background-color: var(--accent); color: white; border: none; padding: 0.6rem 1.2rem;
             border-radius: 20px; cursor: pointer; font-weight: bold; width: 100%; transition: background-color 0.3s;
        }
        .details-btn:hover { background-color: #e66a20; }
        
        /* Modal Styles */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: var(--light); color: var(--dark);
            margin: auto; padding: 25px; border: 1px solid #888;
            width: 90%; max-width: 500px; border-radius: 15px; text-align: center;
            position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .dark-mode .modal-content { background-color: #032b2d; color: var(--light); }
        .modal-close {
            color: #aaa; position: absolute; top: 10px; right: 20px;
            font-size: 28px; font-weight: bold; cursor: pointer;
        }

        /* Surah Details Modal */
        .surah-details .modal-content { max-width: 800px; text-align: left; }
        .details-box {
            border: 2px solid var(--border-dark); border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem;
        }
        .dark-mode .details-box { border-color: var(--border-light); }
        .details-box .arabic { font-size: 1.8rem; text-align: right; line-height: 3rem; font-family: 'Traditional Arabic', 'Amiri', serif; }
        .details-box .bangla { font-size: 1.1rem; line-height: 1.8; }
        .details-box .translation { font-size: 1rem; font-style: italic; line-height: 1.7; }
        .audio-player { width: 100%; margin-top: 1rem; }

        /* Donation Modal Content */
        #qrCodeImg { width: 200px; height: 200px; margin: 1rem auto; display: block; border-radius: 8px; }
        #upiId { font-weight: bold; font-size: 1.1rem; margin-top: 1rem; user-select: all; word-break: break-all; }

        /* Prayer Times Modal */
        #prayerTimesList { list-style: none; padding: 0; margin-top: 1rem; }
        #prayerTimesList li { display: flex; justify-content: space-between; padding: 0.8rem; border-bottom: 1px solid #ddd; }
        .dark-mode #prayerTimesList li { border-bottom-color: #444; }
        #prayerTimesList li:last-child { border-bottom: none; }
        #prayerTimesList span { font-weight: bold; color: var(--primary); }
        .dark-mode #prayerTimesList span { color: var(--accent); }

        /* Qibla Compass Modal */
        #compass { width: 200px; height: 200px; margin: 1.5rem auto; border: 5px solid var(--primary); border-radius: 50%; position: relative; }
        #qiblaNeedle {
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-bottom: 100px solid var(--accent); position: absolute; top: 0; left: 50%;
            transform-origin: bottom center; transform: translateX(-50%); transition: transform 0.5s;
        }
        #compass-info { font-size: 0.9rem; color: #666; }
        .dark-mode #compass-info { color: #aaa; }

        /* Tasbih Counter Modal */
        #tasbihDisplay { font-size: 5rem; font-weight: bold; margin: 1rem 0; color: var(--primary); }
        #tasbihCountBtn {
            width: 150px; height: 150px; border-radius: 50%; border: none; background-color: var(--primary);
            color: white; font-size: 2rem; cursor: pointer; margin-bottom: 1rem;
        }
        #tasbihResetBtn { background-color: var(--accent); color: white; border: none; padding: 0.7rem 1.5rem; border-radius: 20px; cursor: pointer; }
        
        footer { text-align: center; padding: 1.5rem; margin-top: 2rem; color: #777; }
        .dark-mode footer { color: #aaa; }

        @media (max-width: 600px) {
            .feature-buttons { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <h1>সহজ সূরা</h1>
        <p>বাংলা উচ্চারণ ও অর্থ সহ</p>
    </header>
    
    <div class="container">
        <input type="text" class="search-bar" placeholder="সূরা খুঁজুন (নাম, উচ্চারণ বা অনুবাদ)...">
        
        <div class="feature-buttons">
            <button class="feature-btn" id="prayerTimeBtn">নামাজের সময়</button>
            <button class="feature-btn" id="qiblaBtn">কিবলা কম্পাস</button>
            <button class="feature-btn" id="tasbihBtn">তাসবিহ কাউন্টার</button>
            <button class="feature-btn" id="donateBtn">ডোনেট করুন</button>
        </div>

        <div class="surah-list"></div>
    </div>
    
    <!-- All Modals Below -->
    <div id="surahDetailsModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="detailsContent"></div>
        </div>
    </div>

    <div id="donationModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>সাহায্য করুন</h2>
            <p>এই অ্যাপটির উন্নতির জন্য আপনার সাহায্যের প্রয়োজন।</p>
            <img id="qrCodeImg" src="" alt="UPI QR Code Loading...">
            <p>UPI ID:</p>
            <p id="upiId">ajibuddin58@axl</p>
        </div>
    </div>

    <div id="prayerModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>নামাজের সময়</h2>
            <div id="prayerTimesContent"><p>আপনার অবস্থান অনুযায়ী নামাজের সময় পেতে লোকেশন অ্যাক্সেস দিন...</p></div>
        </div>
    </div>

    <div id="qiblaModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>কিবলা কম্পাস</h2>
            <div id="compass">
                <div id="qiblaNeedle"></div>
            </div>
            <p id="compass-info">সঠিক দিক পেতে আপনার মোবাইল সমান্তরালভাবে ধরে রাখুন।</p>
        </div>
    </div>

    <div id="tasbihModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>তাসবিহ কাউন্টার</h2>
            <div id="tasbihDisplay">0</div>
            <button id="tasbihCountBtn">গণনা</button>
            <button id="tasbihResetBtn">রিসেট</button>
        </div>
    </div>
    
    <button class="theme-toggle" id="themeToggle">🌓</button>

    <footer>
        <p>অ্যাপটি তৈরি করেছেনঃ আজিবুদ্দিন</p>
    </footer>
    
    <script>
        // Surah Data (shortened for brevity)
        const surahs = [
             { id: 1, name: "সূরা আল-ফাতিহা", arabic: "بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ ﴿١﴾ ٱلْحَمْدُ لِلَّهِ رَبِّ ٱلْعَٰلَمِينَ ﴿٢﴾ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ ﴿٣﴾ مَٰلِكِ يَوْمِ ٱلدِّينِ ﴿٤﴾ إِيَّاكَ نَعْبُدُ وَإِيَّاكَ نَسْتَعِينُ ﴿٥﴾ ٱهْدِنَا ٱلصِّرَٰطَ ٱلْمُسْتَقِيمَ ﴿٦﴾ صِرَٰطَ ٱلَّذِينَ أَنْعَمْتَ عَلَيْهِمْ غَيْرِ ٱلْمَغْضُوبِ عَلَيْهِمْ وَلَا ٱلضَّآلِّينَ ﴿٧﴾", bangla: "বিসমিল্লাহির রাহমানির রাহীম। (১) আলহামদু লিল্লাহি রাব্বিল আলামীন। (২) আর রাহমানির রাহীম। (৩) মালিকি ইয়াওমিদ্দীন। (৪) ইয়্যাকা নাবুদু ওয়া ইয়্যাকা নাসতাঈন। (৫) ইহদিনাস সিরাতাল মুস্তাকীম। (৬) সিরাতাল্লাজিনা আনআমতা আলাইহিম, গাইরিল মাগদুবি আলাইহিম ওয়ালাদ দাল্লীন। (৭)", translation: "পরম করুণাময় অসীম দয়ালু আল্লাহর নামে। (১) সমস্ত প্রশংসা আল্লাহর জন্য, যিনি সকল সৃষ্টির প্রতিপালক। (২) যিনি পরম করুণাময়, অতি দয়ালু। (৩) বিচার দিনের মালিক। (৪) আমরা শুধু তোমারই ইবাদত করি এবং শুধু তোমার কাছেই সাহায্য চাই। (৫) আমাদেরকে সরল পথ দেখাও। (৬) তাদের পথ যাদেরকে তুমি নেয়ামত দান করেছ, যারা অভিশপ্ত নয় এবং পথভ্রষ্টও নয়। (৭)", audio: "https://server.mp3quran.net/sds/001.mp3" },
             { id: 112, name: "সূরা আল-ইখলাস", arabic: "بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ قُلْ هُوَ ٱللَّهُ أَحَدٌ ﴿١﴾ ٱللَّهُ ٱلصَّمَدُ ﴿٢﴾ لَمْ يَلِدْ وَلَمْ يُولَدْ ﴿٣﴾ وَلَمْ يَكُن لَّهُۥ كُفُوًا أَحَدٌۢ ﴿٤﴾", bangla: "বিসমিল্লাহির রাহমানির রাহীম। কুল হুয়াল্লাহু আহাদ। (১) আল্লাহুস সামাদ। (২) লাম ইয়ালিদ ওয়া লাম ইউলাদ। (৩) ওয়া লাম ইয়াকুল্লাহু কুফুয়ান আহাদ। (৪)", translation: "পরম করুণাময় অসীম দয়ালু আল্লাহর নামে। বলুন, তিনি আল্লাহ, একক। (১) আল্লাহ অমুখাপেক্ষী। (২) তিনি কাউকে জন্ম দেননি এবং তাঁকেও জন্ম দেওয়া হয়নি। (৩) এবং তাঁর সমতুল্য কেউ নেই। (৪)", audio: "https://server.mp3quran.net/sds/112.mp3" },
             { id: 113, name: "সূরা আল-ফালাক", arabic: "بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ ﴿١﴾ مِن شَرِّ مَا خَلَقَ ﴿٢﴾ وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ ﴿٣﴾ وَمِن شَرِّ ٱلنَّفَّٰثَٰتِ فِى ٱلْعُقَدِ ﴿٤﴾ وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ ﴿٥﴾", bangla: "বিসমিল্লাহির রাহমানির রাহীম। কুল আউযু বিরাব্বিল ফালাক। (১) মিন শাররি মা খালাক। (২) ওয়া মিন শাররি গাসিকিন ইযা ওয়াকাব। (৩) ওয়া মিন শাররিন নাফফাসাতি ফিল উকাদ। (৪) ওয়া মিন শাররি হাসিদিন ইযা হাসাদ। (৫)", translation: "পরম করুণাময় অসীম দয়ালু আল্লাহর নামে। বলুন, আমি আশ্রয় গ্রহণ করছি ভোরের রবের, (১) তাঁর সৃষ্টির অনিষ্ট থেকে, (২) অন্ধকার রাতের অনিষ্ট থেকে যখন তা সমাগত হয়, (৩) গিঁটে ফুঁৎকার দেয়াদের অনিষ্ট থেকে, (৪) এবং হিংসুকের অনিষ্ট থেকে যখন সে হিংসা করে। (৫)", audio: "https://server.mp3quran.net/sds/113.mp3" },
             { id: 114, name: "সূরা আন-নাস", arabic: "بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ ﴿١﴾ مَلِكِ ٱلنَّاسِ ﴿٢﴾ إِلَٰهِ ٱلنَّاسِ ﴿٣﴾ مِن شَرِّ ٱلْوَسْوَاسِ ٱلْخَنَّاسِ ﴿٤﴾ ٱلَّذِى يُوَسْوِسُ فِى صُدُورِ ٱلنَّاسِ ﴿٥﴾ مِنَ ٱلْجِنَّةِ وَٱلنَّاسِ ﴿٦﴾", bangla: "বিসমিল্লাহির রাহমানির রাহীম। কুল আউযু বিরাব্বিন নাস। (১) মালিকিন নাস। (২) ইলাহিন নাস। (৩) মিন শাররিল ওয়াসওয়াসিল খান্নাস। (৪) আল্লাযী ইউওয়াস ওয়িসু ফী সুদুরিন নাস। (৫) মিনাল জিন্নাতি ওয়ান নাস। (৬)", translation: "পরম করুণাময় অসীম দয়ালু আল্লাহর নামে। বলুন, আমি আশ্রয় গ্রহণ করছি মানুষের রবের, (১) মানুষের অধিপতির, (২) মানুষের ইলাহের, (৩) কুমন্ত্রণাদাতার অনিষ্ট থেকে যে পিছনে সরে যায়, (৪) যে মানুষের অন্তরে কুমন্ত্রণা দেয়, (৫) জিন ও মানুষের পক্ষ থেকে। (৬)", audio: "https://server.mp3quran.net/sds/114.mp3" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const surahList = document.querySelector('.surah-list');
            const searchBar = document.querySelector('.search-bar');
            const themeToggle = document.getElementById('themeToggle');

            // --- Modal Elements ---
            const modals = document.querySelectorAll('.modal');
            const surahDetailsModal = document.getElementById('surahDetailsModal');
            const donationModal = document.getElementById('donationModal');
            const prayerModal = document.getElementById('prayerModal');
            const qiblaModal = document.getElementById('qiblaModal');
            const tasbihModal = document.getElementById('tasbihModal');
            
            // --- Feature Buttons ---
            const donateBtn = document.getElementById('donateBtn');
            const prayerTimeBtn = document.getElementById('prayerTimeBtn');
            const qiblaBtn = document.getElementById('qiblaBtn');
            const tasbihBtn = document.getElementById('tasbihBtn');

            // --- Surah Loading and Display ---
            function loadSurahs(surahArray = surahs) {
                surahList.innerHTML = '';
                surahArray.forEach(surah => {
                    const surahCard = document.createElement('div');
                    surahCard.className = 'surah-card';
                    surahCard.innerHTML = `<div class="surah-header"><h3>${surah.name}</h3><span>${surah.id}</span></div>
                                        <div class="surah-content"><p class="arabic-preview">${surah.arabic.substring(0, 70)}...</p>
                                        <button class="details-btn" data-id="${surah.id}">বিস্তারিত দেখুন</button></div>`;
                    surahList.appendChild(surahCard);
                });

                document.querySelectorAll('.details-btn').forEach(button => {
                    button.addEventListener('click', function() { showSurahDetails(parseInt(this.dataset.id)); });
                });
            }

            function showSurahDetails(id) {
                const surah = surahs.find(s => s.id === id);
                if (surah) {
                    const detailsContent = surahDetailsModal.querySelector('#detailsContent');
                    detailsContent.innerHTML = `<h2>${surah.name}</h2>
                                                <div class="details-box"><p class="arabic">${surah.arabic}</p></div>
                                                <div class="details-box"><p class="bangla">${surah.bangla}</p></div>
                                                <div class="details-box"><p class="translation">${surah.translation}</p></div>
                                                <audio controls class="audio-player"><source src="${surah.audio}" type="audio/mpeg"></audio>`;
                    surahDetailsModal.style.display = 'flex';
                }
            }

            // --- Generic Modal Handling ---
            modals.forEach(modal => {
                const closeBtn = modal.querySelector('.modal-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        modal.style.display = 'none';
                        // Stop any media playing in the modal
                        const audio = modal.querySelector('audio');
                        if (audio) audio.pause();
                        // Stop Qibla compass updates
                        if (modal.id === 'qiblaModal') stopQiblaCompass();
                    });
                }
            });
            window.addEventListener('click', (event) => {
                modals.forEach(modal => { if (event.target == modal) modal.style.display = 'none'; });
            });

            // --- Search and Theme ---
            searchBar.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filteredSurahs = surahs.filter(surah => 
                    surah.name.toLowerCase().includes(searchTerm) || 
                    surah.bangla.toLowerCase().includes(searchTerm) ||
                    surah.translation.toLowerCase().includes(searchTerm));
                loadSurahs(filteredSurahs);
            });
            themeToggle.addEventListener('click', () => document.body.classList.toggle('dark-mode'));

            // --- Donation Feature ---
            donateBtn.addEventListener('click', () => {
                const upiId = 'ajibuddin58@axl';
                const upiName = 'Ajibuddin';
                const qrImg = document.getElementById('qrCodeImg');
                const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=${upiId}&pn=${upiName}`;
                qrImg.src = qrApiUrl;
                qrImg.alt = "UPI QR Code";
                donationModal.style.display = 'flex';
            });
            
            // --- Prayer Times Feature ---
            prayerTimeBtn.addEventListener('click', () => {
                prayerModal.style.display = 'flex';
                const contentDiv = document.getElementById('prayerTimesContent');
                contentDiv.innerHTML = '<p>আপনার অবস্থান খোঁজা হচ্ছে...</p>';

                navigator.geolocation.getCurrentPosition(async position => {
                    const { latitude, longitude } = position.coords;
                    try {
                        const response = await fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=2`);
                        if (!response.ok) throw new Error('API থেকে ডেটা পাওয়া যায়নি।');
                        const data = await response.json();
                        const timings = data.data.timings;
                        contentDiv.innerHTML = `
                            <p>${data.data.meta.timezone} (আজ)</p>
                            <ul id="prayerTimesList">
                                <li>ফজর <span>${timings.Fajr}</span></li>
                                <li>যোহর <span>${timings.Dhuhr}</span></li>
                                <li>আসর <span>${timings.Asr}</span></li>
                                <li>মাগরিব <span>${timings.Maghrib}</span></li>
                                <li>ইশা <span>${timings.Isha}</span></li>
                            </ul>`;
                    } catch (error) {
                        contentDiv.innerHTML = `<p>দুঃখিত, নামাজের সময় আনা সম্ভব হয়নি।</p>`;
                    }
                }, error => {
                    contentDiv.innerHTML = `<p>অবস্থান অ্যাক্সেস ছাড়া নামাজের সময় দেখানো সম্ভব নয়। দয়া করে লোকেশন অনুমতি দিন।</p>`;
                });
            });

            // --- Qibla Compass Feature ---
            let deviceOrientationListener = null;
            function stopQiblaCompass() {
                if (deviceOrientationListener) {
                    window.removeEventListener('deviceorientationabsolute', deviceOrientationListener);
                    deviceOrientationListener = null;
                }
            }
            qiblaBtn.addEventListener('click', () => {
                qiblaModal.style.display = 'flex';
                const needle = document.getElementById('qiblaNeedle');
                
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission().then(permissionState => {
                        if (permissionState === 'granted') {
                           startQiblaCompass(needle);
                        } else {
                            alert('কিবলা কম্পাসের জন্য সেন্সর অ্যাক্সেস প্রয়োজন।');
                        }
                    }).catch(console.error);
                } else {
                    startQiblaCompass(needle);
                }
            });

            function startQiblaCompass(needle) {
                 navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    const kaabaLat = 21.4225; // Kaaba latitude
                    const kaabaLon = 39.8262; // Kaaba longitude

                    const userLatRad = latitude * Math.PI / 180;
                    const kaabaLatRad = kaabaLat * Math.PI / 180;
                    const lonDiffRad = (kaabaLon - longitude) * Math.PI / 180;

                    const y = Math.sin(lonDiffRad) * Math.cos(kaabaLatRad);
                    const x = Math.cos(userLatRad) * Math.sin(kaabaLatRad) - Math.sin(userLatRad) * Math.cos(kaabaLatRad) * Math.cos(lonDiffRad);
                    const qiblaBearing = (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;

                    deviceOrientationListener = (event) => {
                        const heading = event.webkitCompassHeading || event.alpha; // For iOS and others
                        const rotation = qiblaBearing - heading;
                        needle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
                    };
                    window.addEventListener('deviceorientationabsolute', deviceOrientationListener, true);

                }, () => {
                    alert('কিবলা নির্ণয়ের জন্য লোকেশন অ্যাক্সেস প্রয়োজন।');
                });
            }

            // --- Tasbih Counter Feature ---
            const tasbihDisplay = document.getElementById('tasbihDisplay');
            const tasbihCountBtn = document.getElementById('tasbihCountBtn');
            const tasbihResetBtn = document.getElementById('tasbihResetBtn');
            let count = 0;

            tasbihBtn.addEventListener('click', () => {
                tasbihModal.style.display = 'flex';
            });
            tasbihCountBtn.addEventListener('click', () => {
                count++;
                tasbihDisplay.textContent = count;
            });
            tasbihResetBtn.addEventListener('click', () => {
                count = 0;
                tasbihDisplay.textContent = count;
            });

            // Initial load
            loadSurahs();
        });
    </script>
</body>
</html>
